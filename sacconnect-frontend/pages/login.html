<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body>

    <h1>Welcome to Student Connect Login</h1>

    <div class="container">
      <form id="loginForm">

        <label for="email">Email (csus.edu)</label>
        <input type="email" id="email" required>

        <label for="password">Password</label>
        <input type="password" id="password" required>

        <button type="submit">Login</button>

        <p class="signup_login">
          First time here? Click here to <a href="./signup.html">Sign Up</a>
        </p>

        <p id="loginMessage"></p>
      </form>
    </div>

    <script>
      const loginForm = document.getElementById('loginForm');
      const loginMessage = document.getElementById('loginMessage');

      loginForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        const body = { email, password };

        try {
          const response = await fetch('http://localhost:8080/api/users/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          });

          if (response.ok) {
            const data = await response.json();

           
            localStorage.setItem('userId', data.id);
            localStorage.setItem('userEmail', data.email);

            
            if (!data.profileComplete) {
              
              window.location.href = './edit-profile.html';
            } else {
              
              window.location.href = '../index.html';
            }

          } else {
            const errorText = await response.text();
            loginMessage.textContent = errorText || 'Login failed.';
            loginMessage.style.color = 'red';
          }
        } catch (err) {
          console.error(err);
          loginMessage.textContent = 'Error connecting to server.';
          loginMessage.style.color = 'red';
        }
      });
    </script>
  </body>
</html>
